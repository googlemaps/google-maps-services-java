/*
 * Copyright 2014 Google Inc. All rights reserved.
 *
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

package com.google.maps;

import static com.google.maps.model.ComponentFilter.administrativeArea;
import static com.google.maps.model.ComponentFilter.country;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.fail;

import com.google.maps.model.AddressComponentType;
import com.google.maps.model.AddressType;
import com.google.maps.model.ComponentFilter;
import com.google.maps.model.GeocodingResult;
import com.google.maps.model.LatLng;
import com.google.maps.model.LocationType;

import org.junit.Test;
import org.junit.experimental.categories.Category;

import java.util.ArrayList;
import java.util.List;

@Category(MediumTests.class)
public class GeocodingApiTest {

  private static final double EPSILON = 0.005;

  @Test
  public void testSimpleGeocode() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5781409,\n"
        + "                  \"lng\" : 151.3430209\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118347,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8688197,\n"
        + "               \"lng\" : 151.2092955\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5782519,\n"
        + "                  \"lng\" : 151.3429976\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118328,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP3Sa8ziYEmsRUKgyFmh9AQM\",\n"
        + "         \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).address("Sydney").await();
    checkSydneyResult(results);

    sc.assertParamValue("Sydney", "address");
  }

  @Test
  public void testPlaceGeocode() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5781409,\n"
        + "                  \"lng\" : 151.3430209\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118347,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8688197,\n"
        + "               \"lng\" : 151.2092955\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5782519,\n"
        + "                  \"lng\" : 151.3429976\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118328,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP3Sa8ziYEmsRUKgyFmh9AQM\",\n"
        + "         \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    String placeID = "ChIJP3Sa8ziYEmsRUKgyFmh9AQM";
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .place(placeID)
        .await();
    checkSydneyResult(results);

    sc.assertParamValue(placeID, "place_id");
  }

  @Test
  public void testAsync() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5781409,\n"
        + "                  \"lng\" : 151.3430209\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118347,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8688197,\n"
        + "               \"lng\" : 151.2092955\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5782519,\n"
        + "                  \"lng\" : 151.3429976\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118328,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP3Sa8ziYEmsRUKgyFmh9AQM\",\n"
        + "         \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    final List<GeocodingResult[]> resps = new ArrayList<GeocodingResult[]>();

    PendingResult.Callback<GeocodingResult[]> callback =
        new PendingResult.Callback<GeocodingResult[]>() {
          @Override
          public void onResult(GeocodingResult[] result) {
            resps.add(result);
          }

          @Override
          public void onFailure(Throwable e) {
            fail("Got error when expected success.");
          }
        };
    GeocodingApi.newRequest(sc.context).address("Sydney").setCallback(callback);

    Thread.sleep(2500);

    assertFalse(resps.isEmpty());
    assertNotNull(resps.get(0));
    checkSydneyResult(resps.get(0));

    sc.assertParamValue("Sydney", "address");
  }

  private void checkSydneyResult(GeocodingResult[] results) {
    assertNotNull(results);
    assertNotNull(results[0].geometry);
    assertNotNull(results[0].geometry.location);
    assertEquals(-33.8674869, results[0].geometry.location.lat, EPSILON);
    assertEquals(151.2069902, results[0].geometry.location.lng, EPSILON);
    assertEquals(LocationType.APPROXIMATE, results[0].geometry.locationType);
  }

  @Test
  public void testReverseGeocode() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"343\",\n"
        + "               \"short_name\" : \"343\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"George Street\",\n"
        + "               \"short_name\" : \"George St\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Council of the City of Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"2000\",\n"
        + "               \"short_name\" : \"2000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"343 George St, Sydney NSW 2000, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8675084,\n"
        + "               \"lng\" : 151.2066756\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8661594197085,\n"
        + "                  \"lng\" : 151.2080245802915\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.86885738029149,\n"
        + "                  \"lng\" : 151.2053266197085\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJg5VYhUCuEmsRbw9hp4iPf-w\",\n"
        + "         \"types\" : [ \"street_address\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"York St Near Barrack St\",\n"
        + "               \"short_name\" : \"York St Near Barrack St\",\n"
        + "               \"types\" : [\n"
        + "                  \"bus_station\",\n"
        + "                  \"establishment\",\n"
        + "                  \"point_of_interest\",\n"
        + "                  \"transit_station\"\n"
        + "               ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Council of the City of Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"2017\",\n"
        + "               \"short_name\" : \"2017\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"York St Near Barrack St, Sydney NSW 2017, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8679199,\n"
        + "               \"lng\" : 151.2060489\n"
        + "            },\n"
        + "            \"location_type\" : \"GEOMETRIC_CENTER\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.86657091970849,\n"
        + "                  \"lng\" : 151.2073978802915\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.86926888029149,\n"
        + "                  \"lng\" : 151.2046999197085\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJQ2jNn0CuEmsRjff6m9bEJEM\",\n"
        + "         \"types\" : [\n"
        + "            \"bus_station\",\n"
        + "            \"establishment\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"transit_station\"\n"
        + "         ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"2000\",\n"
        + "               \"short_name\" : \"2000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW 2000, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8561088,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8797035,\n"
        + "                  \"lng\" : 151.1970329\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8688197,\n"
        + "               \"lng\" : 151.2092955\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8561088,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8797035,\n"
        + "                  \"lng\" : 151.1970329\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP5iLHkCuEmsRwMwyFmh9AQU\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5781409,\n"
        + "                  \"lng\" : 151.3430209\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118347,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8688197,\n"
        + "               \"lng\" : 151.2092955\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.5782519,\n"
        + "                  \"lng\" : 151.3429976\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.118328,\n"
        + "                  \"lng\" : 150.5209286\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP3Sa8ziYEmsRUKgyFmh9AQM\",\n"
        + "         \"types\" : [ \"colloquial_area\", \"locality\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"2017\",\n"
        + "               \"short_name\" : \"2017\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Council of the City of Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW 2017, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8664717,\n"
        + "                  \"lng\" : 151.2117013\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8792609,\n"
        + "                  \"lng\" : 151.204416\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8673275,\n"
        + "               \"lng\" : 151.2114041\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8664717,\n"
        + "                  \"lng\" : 151.2117013\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8792609,\n"
        + "                  \"lng\" : 151.204416\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJOejzimquEmsRxmGtuAZySvE\",\n"
        + "         \"types\" : [ \"postal_code\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"2000\",\n"
        + "               \"short_name\" : \"2000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney NSW 2000, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8535504,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8858133,\n"
        + "                  \"lng\" : 151.1970329\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8708464,\n"
        + "               \"lng\" : 151.20733\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8535504,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8858133,\n"
        + "                  \"lng\" : 151.1970329\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJP-njCjuuEmsRcIe6P2t9ARw\",\n"
        + "         \"postcode_localities\" : [\n"
        + "            \"Barangaroo\",\n"
        + "            \"Dawes Point\",\n"
        + "            \"Haymarket\",\n"
        + "            \"Millers Point\",\n"
        + "            \"Sydney\",\n"
        + "            \"The Rocks\"\n"
        + "         ],\n"
        + "         \"types\" : [ \"postal_code\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney CBD\",\n"
        + "               \"short_name\" : \"Sydney CBD\",\n"
        + "               \"types\" : [ \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney CBD, NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8535504,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8858133,\n"
        + "                  \"lng\" : 151.186625\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8708464,\n"
        + "               \"lng\" : 151.20733\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.8535504,\n"
        + "                  \"lng\" : 151.222951\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.8858133,\n"
        + "                  \"lng\" : 151.186625\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJKaeYMj-uEmsRAgZ4clX6UO8\",\n"
        + "         \"types\" : [ \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Council of the City of Sydney\",\n"
        + "               \"short_name\" : \"Sydney\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney, NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.85364920000001,\n"
        + "                  \"lng\" : 151.2331075\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.9243909,\n"
        + "                  \"lng\" : 151.1749538\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8967541,\n"
        + "               \"lng\" : 151.1985879\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.85364920000001,\n"
        + "                  \"lng\" : 151.2331075\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -33.9243909,\n"
        + "                  \"lng\" : 151.1749538\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJl9aAttixEmsR8d2wSrqVi5k\",\n"
        + "         \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Sydney Metropolitan Area\",\n"
        + "               \"short_name\" : \"Sydney Metropolitan Area\",\n"
        + "               \"types\" : [ \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Sydney Metropolitan Area, NSW, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.3640261,\n"
        + "                  \"lng\" : 151.3439\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.1896128,\n"
        + "                  \"lng\" : 150.5883888\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -33.8817547,\n"
        + "               \"lng\" : 150.8609358\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -33.3640261,\n"
        + "                  \"lng\" : 151.3438984\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -34.1896128,\n"
        + "                  \"lng\" : 150.5883888\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJI1bpHkCuEmsRcTz72E_A69A\",\n"
        + "         \"types\" : [ \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"New South Wales\",\n"
        + "               \"short_name\" : \"NSW\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Australia\",\n"
        + "               \"short_name\" : \"AU\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"New South Wales, Australia\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -28.15702,\n"
        + "                  \"lng\" : 159.1054441\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -37.5052801,\n"
        + "                  \"lng\" : 140.9992793\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : -31.2532183,\n"
        + "               \"lng\" : 146.921099\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : -28.1570718,\n"
        + "                  \"lng\" : 153.6385162\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : -37.5050181,\n"
        + "                  \"lng\" : 140.9992793\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJDUte93TLDWsRLZ_EIhGvgBc\",\n"
        + "         \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    LatLng latlng = new LatLng(-33.8674869, 151.2069902);
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .latlng(latlng).await();

    assertEquals(10, results.length);
    assertEquals("343 George St, Sydney NSW 2000, Australia", results[0].formattedAddress);
    assertEquals("York St Near Barrack St, Sydney NSW 2017, Australia", results[1].formattedAddress);
    assertEquals("Sydney NSW 2000, Australia", results[2].formattedAddress);

    sc.assertParamValue(latlng.toUrlValue(), "latlng");
  }

  /**
   * Simple geocode sample:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA">
   * Address Geocode for "1600 Amphitheatre Parkway, Mountain View, CA"</a>.
   */
  @Test
  public void testGeocodeTheGoogleplex() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Google Building 41\",\n"
        + "               \"short_name\" : \"Google Bldg 41\",\n"
        + "               \"types\" : [ \"premise\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"1600\",\n"
        + "               \"short_name\" : \"1600\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Amphitheatre Parkway\",\n"
        + "               \"short_name\" : \"Amphitheatre Pkwy\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Mountain View\",\n"
        + "               \"short_name\" : \"Mountain View\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Santa Clara County\",\n"
        + "               \"short_name\" : \"Santa Clara County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"California\",\n"
        + "               \"short_name\" : \"CA\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"94043\",\n"
        + "               \"short_name\" : \"94043\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Google Bldg 41, 1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 37.4228642,\n"
        + "                  \"lng\" : -122.0851557\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 37.4221145,\n"
        + "                  \"lng\" : -122.0859841\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 37.4224082,\n"
        + "               \"lng\" : -122.0856086\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 37.4238383302915,\n"
        + "                  \"lng\" : -122.0842209197085\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 37.4211403697085,\n"
        + "                  \"lng\" : -122.0869188802915\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJxQvW8wK6j4AR3ukttGy3w2s\",\n"
        + "         \"types\" : [ \"premise\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    String address = "1600 Amphitheatre Parkway, Mountain View, CA";
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .address(address).await();

    assertNotNull(results);
    assertEquals("Google Bldg 41, 1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA",
        results[0].formattedAddress);
    sc.assertParamValue(address, "address");
  }

  /**
   * Address geocode with bounds:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?address=Winnetka&bounds=34.172684,-118.604794|34.236144,-118.500938">
   * Winnetka within (34.172684,-118.604794) - (34.236144,-118.500938)</a>.
   */
  @Test
  public void testGeocodeWithBounds() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Winnetka\",\n"
        + "               \"short_name\" : \"Winnetka\",\n"
        + "               \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Los Angeles\",\n"
        + "               \"short_name\" : \"Los Angeles\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Los Angeles County\",\n"
        + "               \"short_name\" : \"Los Angeles County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"California\",\n"
        + "               \"short_name\" : \"CA\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Winnetka, Los Angeles, CA, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 34.2355209,\n"
        + "                  \"lng\" : -118.5534191\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.1854649,\n"
        + "                  \"lng\" : -118.588536\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 34.2048586,\n"
        + "               \"lng\" : -118.5739621\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 34.2355209,\n"
        + "                  \"lng\" : -118.5534191\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.1854649,\n"
        + "                  \"lng\" : -118.588536\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ0fd4S_KbwoAR2hRDrsr3HmQ\",\n"
        + "         \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).address("Winnetka")
        .bounds(new LatLng(34.172684, -118.604794), new LatLng(34.236144, -118.500938)).await();

    assertEquals("Winnetka, Los Angeles, CA, USA", results[0].formattedAddress);
    assertEquals("ChIJ0fd4S_KbwoAR2hRDrsr3HmQ", results[0].placeId);

    sc.assertParamValue("Winnetka", "address");
    sc.assertParamValue("34.17268400,-118.60479400|34.23614400,-118.50093800", "bounds");
  }

  /**
   * Geocode with region biasing:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?address=Toledo&region=es>Geocode
   * for Toledo in Spain</a>.
   */
  @Test
  public void testGeocodeWithRegionBiasing() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Toledo\",\n"
        + "               \"short_name\" : \"Toledo\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Toledo\",\n"
        + "               \"short_name\" : \"TO\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Castile-La Mancha\",\n"
        + "               \"short_name\" : \"CM\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Spain\",\n"
        + "               \"short_name\" : \"ES\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Toledo, Spain\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 39.88605099999999,\n"
        + "                  \"lng\" : -3.9192423\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.8383676,\n"
        + "                  \"lng\" : -4.0796176\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 39.8628316,\n"
        + "               \"lng\" : -4.027323099999999\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 39.88605099999999,\n"
        + "                  \"lng\" : -3.9192423\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.8383676,\n"
        + "                  \"lng\" : -4.0796176\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ8f21C60Lag0R_q11auhbf8Y\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).address("Toledo").region("es")
        .await();

    assertNotNull(results);
    assertEquals("Toledo, Spain", results[0].formattedAddress);
    assertEquals(AddressType.LOCALITY, results[0].types[0]);
    assertEquals(AddressType.POLITICAL, results[0].types[1]);

    sc.assertParamValue("Toledo", "address");
    sc.assertParamValue("es", "region");
  }

  /**
   * Geocode with component filtering:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?address=santa+cruz&components=country:ES">
   * Geocoding "santa cruz" with country set to ES</a>.
   */
  @Test
  public void testGeocodeWithComponentFilter() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Santa Cruz de Tenerife\",\n"
        + "               \"short_name\" : \"Santa Cruz de Tenerife\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Santa Cruz de Tenerife\",\n"
        + "               \"short_name\" : \"TF\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Canary Islands\",\n"
        + "               \"short_name\" : \"CN\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Spain\",\n"
        + "               \"short_name\" : \"ES\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Santa Cruz de Tenerife, Spain\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 28.487616,\n"
        + "                  \"lng\" : -16.2356646\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 28.4280248,\n"
        + "                  \"lng\" : -16.3370045\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 28.4636296,\n"
        + "               \"lng\" : -16.2518467\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 28.487616,\n"
        + "                  \"lng\" : -16.2356646\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 28.4280248,\n"
        + "                  \"lng\" : -16.3370045\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJcUElzOzMQQwRLuV30nMUEUM\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).address("santa cruz")
        .components(ComponentFilter.country("ES")).await();

    assertEquals("Santa Cruz de Tenerife, Spain", results[0].formattedAddress);
    assertEquals("ChIJcUElzOzMQQwRLuV30nMUEUM", results[0].placeId);

    sc.assertParamValue("country:ES", "components");
    sc.assertParamValue("santa cruz", "address");
  }

  /**
   * Geocode with multiple component filters:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?address=Torun&components=administrative_area:TX|country:US">
   * Geocoding Torun, with administrative area of "TX" and country of "US"</a>.
   */
  @Test
  public void testGeocodeWithMultipleComponentFilters() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Texas\",\n"
        + "               \"short_name\" : \"TX\",\n"
        + "               \"types\" : [\n"
        + "                  \"administrative_area_level_1\",\n"
        + "                  \"establishment\",\n"
        + "                  \"point_of_interest\",\n"
        + "                  \"political\"\n"
        + "               ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Texas, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 36.5007041,\n"
        + "                  \"lng\" : -93.5080389\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 25.8371638,\n"
        + "                  \"lng\" : -106.6456461\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 31.9685988,\n"
        + "               \"lng\" : -99.9018131\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 36.5018864,\n"
        + "                  \"lng\" : -93.5080389\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 25.83819,\n"
        + "                  \"lng\" : -106.6452951\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"partial_match\" : true,\n"
        + "         \"place_id\" : \"ChIJSTKCCzZwQIYRPN4IGI8c6xY\",\n"
        + "         \"types\" : [\n"
        + "            \"administrative_area_level_1\",\n"
        + "            \"establishment\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"political\"\n"
        + "         ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).address("Torun")
        .components(administrativeArea("TX"), country("US")).await();

    assertEquals("Texas, USA", results[0].formattedAddress);
    assertEquals(true, results[0].partialMatch);
    assertEquals("ChIJSTKCCzZwQIYRPN4IGI8c6xY", results[0].placeId);

    sc.assertParamValue("administrative_area:TX|country:US", "components");
    sc.assertParamValue("Torun", "address");
  }

  /**
   * Making a request using just components filter:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?components=route:Annegatan|administrative_area:Helsinki|country:Finland">
   * Searching for a route of Annegatan, in the administrative area of Helsinki, and the country of
   * Finland </a>.
   */
  @Test
  public void testGeocodeWithJustComponents() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Annankatu\",\n"
        + "               \"short_name\" : \"Annankatu\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Helsinki\",\n"
        + "               \"short_name\" : \"HKI\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Finland\",\n"
        + "               \"short_name\" : \"FI\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"00101\",\n"
        + "               \"short_name\" : \"00101\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Annankatu, 00101 Helsinki, Finland\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 60.168997,\n"
        + "                  \"lng\" : 24.9433353\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 60.16226160000001,\n"
        + "                  \"lng\" : 24.9332897\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 60.1657808,\n"
        + "               \"lng\" : 24.938451\n"
        + "            },\n"
        + "            \"location_type\" : \"GEOMETRIC_CENTER\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 60.168997,\n"
        + "                  \"lng\" : 24.9433353\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 60.16226160000001,\n"
        + "                  \"lng\" : 24.9332897\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"EiBBbm5hbmthdHUsIDAwMTAxIEhlbHNpbmtpLCBTdW9taQ\",\n"
        + "         \"types\" : [ \"route\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context).components(
        ComponentFilter.route("Annegatan"),
        ComponentFilter.administrativeArea("Helsinki"),
        ComponentFilter.country("Finland")).await();

    assertNotNull(results);
    assertEquals("Annankatu, 00101 Helsinki, Finland", results[0].formattedAddress);
    assertEquals("EiBBbm5hbmthdHUsIDAwMTAxIEhlbHNpbmtpLCBTdW9taQ", results[0].placeId);

    sc.assertParamValue("route:Annegatan|administrative_area:Helsinki|country:Finland", "components");
  }

  /**
   * Simple reverse geocoding.
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?latlng=40.714224,-73.961452">
   * Reverse geocode (40.714224,-73.961452)</a>.
   */
  @Test
  public void testSimpleReverseGeocode() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"277\",\n"
        + "               \"short_name\" : \"277\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Bedford Avenue\",\n"
        + "               \"short_name\" : \"Bedford Ave\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Williamsburg\",\n"
        + "               \"short_name\" : \"Williamsburg\",\n"
        + "               \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"11211\",\n"
        + "               \"short_name\" : \"11211\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"277 Bedford Ave, Brooklyn, NY 11211, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7142205,\n"
        + "               \"lng\" : -73.9612903\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.71556948029149,\n"
        + "                  \"lng\" : -73.95994131970849\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.7128715197085,\n"
        + "                  \"lng\" : -73.9626392802915\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJd8BlQ2BZwokRAFUEcm_qrcA\",\n"
        + "         \"types\" : [ \"street_address\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Grand St/Bedford Av\",\n"
        + "               \"short_name\" : \"Grand St/Bedford Av\",\n"
        + "               \"types\" : [\n"
        + "                  \"bus_station\",\n"
        + "                  \"establishment\",\n"
        + "                  \"point_of_interest\",\n"
        + "                  \"transit_station\"\n"
        + "               ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Williamsburg\",\n"
        + "               \"short_name\" : \"Williamsburg\",\n"
        + "               \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"11211\",\n"
        + "               \"short_name\" : \"11211\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Grand St/Bedford Av, Brooklyn, NY 11211, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.714321,\n"
        + "               \"lng\" : -73.961151\n"
        + "            },\n"
        + "            \"location_type\" : \"GEOMETRIC_CENTER\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.71566998029149,\n"
        + "                  \"lng\" : -73.95980201970849\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.7129720197085,\n"
        + "                  \"lng\" : -73.96249998029151\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJi27VXGBZwokRM8ErPyB91yk\",\n"
        + "         \"types\" : [\n"
        + "            \"bus_station\",\n"
        + "            \"establishment\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"transit_station\"\n"
        + "         ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Williamsburg\",\n"
        + "               \"short_name\" : \"Williamsburg\",\n"
        + "               \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"New York\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Williamsburg, Brooklyn, NY, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.7251773,\n"
        + "                  \"lng\" : -73.936498\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.6979329,\n"
        + "                  \"lng\" : -73.96984499999999\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7081156,\n"
        + "               \"lng\" : -73.9570696\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.7251773,\n"
        + "                  \"lng\" : -73.936498\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.6979329,\n"
        + "                  \"lng\" : -73.96984499999999\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJQSrBBv1bwokRbNfFHCnyeYI\",\n"
        + "         \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"New York\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Brooklyn, NY, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.739446,\n"
        + "                  \"lng\" : -73.83336509999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.551042,\n"
        + "                  \"lng\" : -74.05663\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.6781784,\n"
        + "               \"lng\" : -73.94415789999999\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.739446,\n"
        + "                  \"lng\" : -73.83336509999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.551042,\n"
        + "                  \"lng\" : -74.05663\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJCSF8lBZEwokRhngABHRcdoI\",\n"
        + "         \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"New York\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"New York, NY, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.9175771,\n"
        + "                  \"lng\" : -73.70027209999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.4773991,\n"
        + "                  \"lng\" : -74.25908989999999\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7127837,\n"
        + "               \"lng\" : -74.0059413\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.9152555,\n"
        + "                  \"lng\" : -73.70027209999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.4960439,\n"
        + "                  \"lng\" : -74.25573489999999\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJOwg_06VPwokRYv534QaPC8g\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"11211\",\n"
        + "               \"short_name\" : \"11211\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"New York\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Brooklyn, NY 11211, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.7280089,\n"
        + "                  \"lng\" : -73.9207299\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.7008331,\n"
        + "                  \"lng\" : -73.9644697\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7093358,\n"
        + "               \"lng\" : -73.9565551\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.7280089,\n"
        + "                  \"lng\" : -73.9207299\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.7008331,\n"
        + "                  \"lng\" : -73.9644697\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJvbEjlVdZwokR4KapM3WCFRw\",\n"
        + "         \"types\" : [ \"postal_code\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Kings County, NY, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.739446,\n"
        + "                  \"lng\" : -73.83336509999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.551042,\n"
        + "                  \"lng\" : -74.05663\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.6528762,\n"
        + "               \"lng\" : -73.95949399999999\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.7391407,\n"
        + "                  \"lng\" : -73.83363179999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.5703742,\n"
        + "                  \"lng\" : -74.04195919999999\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJOwE7_GTtwokRs75rhW4_I6M\",\n"
        + "         \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"New York-Northern New Jersey-Long Island, NY-NJ-PA\",\n"
        + "               \"short_name\" : \"New York-Northern New Jersey-Long Island, NY-NJ-PA\",\n"
        + "               \"types\" : [ \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"New York-Northern New Jersey-Long Island, NY-NJ-PA, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 41.6018065,\n"
        + "                  \"lng\" : -71.85621399999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.49853299999999,\n"
        + "                  \"lng\" : -75.3585939\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.9590293,\n"
        + "               \"lng\" : -74.0300122\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 41.6018065,\n"
        + "                  \"lng\" : -71.85621399999999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.49853299999999,\n"
        + "                  \"lng\" : -75.3585939\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ3YJV4PRWwokRFFI21ZrHXtQ\",\n"
        + "         \"types\" : [ \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"New York Metropolitan Area\",\n"
        + "               \"short_name\" : \"New York Metropolitan Area\",\n"
        + "               \"types\" : [ \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"New York Metropolitan Area, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 42.0809059,\n"
        + "                  \"lng\" : -71.777491\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.475198,\n"
        + "                  \"lng\" : -75.3587649\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7127761,\n"
        + "               \"lng\" : -74.00595439999999\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 42.0809059,\n"
        + "                  \"lng\" : -71.777491\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 39.475198,\n"
        + "                  \"lng\" : -75.3587649\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ-5Z24NaGwokRiMh4Rj8FNMo\",\n"
        + "         \"types\" : [ \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [\n"
        + "                  \"administrative_area_level_1\",\n"
        + "                  \"establishment\",\n"
        + "                  \"point_of_interest\",\n"
        + "                  \"political\"\n"
        + "               ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"New York, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 45.015865,\n"
        + "                  \"lng\" : -71.777491\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.4773991,\n"
        + "                  \"lng\" : -79.7625901\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 43.2994285,\n"
        + "               \"lng\" : -74.21793260000001\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 45.0125923,\n"
        + "                  \"lng\" : -71.8562029\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.4961036,\n"
        + "                  \"lng\" : -79.761996\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJqaUj8fBLzEwRZ5UY3sHGz90\",\n"
        + "         \"types\" : [\n"
        + "            \"administrative_area_level_1\",\n"
        + "            \"establishment\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"political\"\n"
        + "         ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    LatLng latlng = new LatLng(40.714224, -73.961452);
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .latlng(latlng).await();

    assertNotNull(results);
    assertEquals("277 Bedford Ave, Brooklyn, NY 11211, USA", results[0].formattedAddress);
    assertEquals("277", results[0].addressComponents[0].longName);
    assertEquals("277", results[0].addressComponents[0].shortName);
    assertEquals(AddressComponentType.STREET_NUMBER,
        results[0].addressComponents[0].types[0]);
    assertEquals(AddressType.STREET_ADDRESS, results[0].types[0]);

    sc.assertParamValue(latlng.toUrlValue(), "latlng");
  }

  /**
   * Reverse geocode restricted by type:
   * <a href="https://maps.googleapis.com/maps/api/geocode/json?latlng=40.714224,-73.961452&location_type=ROOFTOP&result_type=street_address">
   * Reverse Geocode (40.714224,-73.961452) with location type of ROOFTOP and result type of
   * street_address</a>.
   */
  @Test
  public void testReverseGeocodeRestrictedByType() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"277\",\n"
        + "               \"short_name\" : \"277\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Bedford Avenue\",\n"
        + "               \"short_name\" : \"Bedford Ave\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Williamsburg\",\n"
        + "               \"short_name\" : \"Williamsburg\",\n"
        + "               \"types\" : [ \"neighborhood\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Brooklyn\",\n"
        + "               \"short_name\" : \"Brooklyn\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kings County\",\n"
        + "               \"short_name\" : \"Kings County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"New York\",\n"
        + "               \"short_name\" : \"NY\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"11211\",\n"
        + "               \"short_name\" : \"11211\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"277 Bedford Ave, Brooklyn, NY 11211, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 40.7142205,\n"
        + "               \"lng\" : -73.9612903\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 40.71556948029149,\n"
        + "                  \"lng\" : -73.95994131970849\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 40.7128715197085,\n"
        + "                  \"lng\" : -73.9626392802915\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJd8BlQ2BZwokRAFUEcm_qrcA\",\n"
        + "         \"types\" : [ \"street_address\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    LatLng latlng = new LatLng(40.714224, -73.961452);
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .latlng(latlng)
        .locationType(LocationType.ROOFTOP)
        .resultType(AddressType.STREET_ADDRESS).await();

    assertNotNull(results);
    assertEquals("277 Bedford Ave, Brooklyn, NY 11211, USA", results[0].formattedAddress);
    assertEquals(LocationType.ROOFTOP, results[0].geometry.locationType);
    assertEquals("ChIJd8BlQ2BZwokRAFUEcm_qrcA", results[0].placeId);

    sc.assertParamValue(latlng.toUrlValue(), "latlng");
    sc.assertParamValue(LocationType.ROOFTOP.toUrlValue(), "location_type");
    sc.assertParamValue(AddressType.STREET_ADDRESS.toUrlValue(), "result_type");
  }

  /**
   * Testing UTF8 result parsing.
   */
  @Test
  public void testUtfResult() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"1\",\n"
        + "               \"short_name\" : \"1\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Rue Fernand Raynaud\",\n"
        + "               \"short_name\" : \"Rue Fernand Raynaud\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Chteauroux\",\n"
        + "               \"short_name\" : \"Chteauroux\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Indre\",\n"
        + "               \"short_name\" : \"Indre\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Centre-Val de Loire\",\n"
        + "               \"short_name\" : \"Centre-Val de Loire\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"36000\",\n"
        + "               \"short_name\" : \"36000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"1 Rue Fernand Raynaud, 36000 Chteauroux, France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 46.8024498,\n"
        + "               \"lng\" : 1.6551494\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 46.8037987802915,\n"
        + "                  \"lng\" : 1.656498380291502\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.8011008197085,\n"
        + "                  \"lng\" : 1.653800419708498\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJaTxVlWSg-0cR0flO9_azzKY\",\n"
        + "         \"types\" : [ \"street_address\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Chteauroux\",\n"
        + "               \"short_name\" : \"Chteauroux\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Indre\",\n"
        + "               \"short_name\" : \"Indre\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Centre-Val de Loire\",\n"
        + "               \"short_name\" : \"Centre-Val de Loire\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"36000\",\n"
        + "               \"short_name\" : \"36000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"36000 Chteauroux, France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 46.8297319,\n"
        + "                  \"lng\" : 1.742437\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.774839,\n"
        + "                  \"lng\" : 1.6381469\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 46.811434,\n"
        + "               \"lng\" : 1.686779\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 46.8297319,\n"
        + "                  \"lng\" : 1.742437\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.774839,\n"
        + "                  \"lng\" : 1.6381469\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJzXfzo6ug-0cR99Yrx4WBLhk\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"36000\",\n"
        + "               \"short_name\" : \"36000\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Chteauroux\",\n"
        + "               \"short_name\" : \"Chteauroux\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Indre\",\n"
        + "               \"short_name\" : \"Indre\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Centre-Val de Loire\",\n"
        + "               \"short_name\" : \"Centre-Val de Loire\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"36000 Chteauroux, France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 46.8298083,\n"
        + "                  \"lng\" : 1.7424276\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.7748461,\n"
        + "                  \"lng\" : 1.6382288\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 46.8031198,\n"
        + "               \"lng\" : 1.6926546\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 46.8298083,\n"
        + "                  \"lng\" : 1.7424276\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.7748461,\n"
        + "                  \"lng\" : 1.6382288\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJMcZg2bqg-0cRUPwJiNrIDRw\",\n"
        + "         \"types\" : [ \"postal_code\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Indre\",\n"
        + "               \"short_name\" : \"Indre\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Centre-Val de Loire\",\n"
        + "               \"short_name\" : \"Centre-Val de Loire\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Indre, France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 47.277465,\n"
        + "                  \"lng\" : 2.204572\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.3469059,\n"
        + "                  \"lng\" : 0.8674139\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 46.6613966,\n"
        + "               \"lng\" : 1.4482662\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 47.277465,\n"
        + "                  \"lng\" : 2.204572\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.3469059,\n"
        + "                  \"lng\" : 0.8674139\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJUfVaUf6d-0cRwCczBdfIDQM\",\n"
        + "         \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Centre-Val de Loire\",\n"
        + "               \"short_name\" : \"Centre-Val de Loire\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Centre-Val de Loire, France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 48.941029,\n"
        + "                  \"lng\" : 3.1284099\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.3469059,\n"
        + "                  \"lng\" : 0.0527369\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 47.7515686,\n"
        + "               \"lng\" : 1.6750631\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 48.941029,\n"
        + "                  \"lng\" : 3.1284099\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 46.3469059,\n"
        + "                  \"lng\" : 0.0527369\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJiV0INnu55EcRMCUzBdfIDQE\",\n"
        + "         \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"France\",\n"
        + "               \"short_name\" : \"FR\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"France\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 51.1241999,\n"
        + "                  \"lng\" : 9.6624999\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 41.3253001,\n"
        + "                  \"lng\" : -5.5591\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 46.227638,\n"
        + "               \"lng\" : 2.213749\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 51.0891628,\n"
        + "                  \"lng\" : 9.5597934\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 41.342778,\n"
        + "                  \"lng\" : -5.1422579\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJMVd4MymgVA0R99lHx5Y__Ws\",\n"
        + "         \"types\" : [ \"country\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    LatLng location = new LatLng(46.8023388, 1.6551867);
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .latlng(location)
        .await();
    assertEquals("1 Rue Fernand Raynaud, 36000 Chteauroux, France", results[0].formattedAddress);
    sc.assertParamValue(location.toUrlValue(), "latlng");
  }

  /**
   * Testing custom parameter pass through.
   *
   * <p>See <a href="https://googlegeodevelopers.blogspot.com.au/2016/11/address-geocoding-in-google-maps-apis.html">
   *     Address Geocoding in the Google Maps APIs</a> for the reasoning behind this usage. </p>
   */
  @Test
  public void testCustomParameterPassThrough() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Google Building 41\",\n"
        + "               \"short_name\" : \"Google Bldg 41\",\n"
        + "               \"types\" : [ \"premise\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"1600\",\n"
        + "               \"short_name\" : \"1600\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Amphitheatre Parkway\",\n"
        + "               \"short_name\" : \"Amphitheatre Pkwy\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Mountain View\",\n"
        + "               \"short_name\" : \"Mountain View\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Santa Clara County\",\n"
        + "               \"short_name\" : \"Santa Clara County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"California\",\n"
        + "               \"short_name\" : \"CA\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"94043\",\n"
        + "               \"short_name\" : \"94043\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Google Bldg 41, 1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 37.4228642,\n"
        + "                  \"lng\" : -122.0851557\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 37.4221145,\n"
        + "                  \"lng\" : -122.0859841\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 37.4224082,\n"
        + "               \"lng\" : -122.0856086\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 37.4238383302915,\n"
        + "                  \"lng\" : -122.0842209197085\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 37.4211403697085,\n"
        + "                  \"lng\" : -122.0869188802915\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJxQvW8wK6j4AR3ukttGy3w2s\",\n"
        + "         \"types\" : [ \"premise\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    String address = "1600 Amphitheatre Parkway, Mountain View, CA";
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
            .address(address)
            .custom("new_forward_geocoder","true")
            .await();

    assertEquals("Google Bldg 41, 1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA", results[0].formattedAddress);

    sc.assertParamValue(address, "address");
    sc.assertParamValue("true", "new_forward_geocoder");
  }

  /**
   * Testing Kita Ward reverse geocode.
   */
  @Test
  public void testReverseGeocodeWithKitaWard() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"\",\n"
        + "               \"short_name\" : \"\",\n"
        + "               \"types\" : [ \"premise\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"\",\n"
        + "               \"short_name\" : \"\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_4\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kinkakujich\",\n"
        + "               \"short_name\" : \"Kinkakujich\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kita-ku\",\n"
        + "               \"short_name\" : \"Kita-ku\",\n"
        + "               \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyto-shi\",\n"
        + "               \"short_name\" : \"Kyto-shi\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyto-fu\",\n"
        + "               \"short_name\" : \"Kyto-fu\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"603-8361\",\n"
        + "               \"short_name\" : \"603-8361\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Japan, 603-8361 Kyto-fu, Kyto-shi, Kita-ku, Kinkakujich,  \",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0396014,\n"
        + "                  \"lng\" : 135.7295118\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0391291,\n"
        + "                  \"lng\" : 135.7289492\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0393986,\n"
        + "               \"lng\" : 135.7293744\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0407142302915,\n"
        + "                  \"lng\" : 135.7305794802915\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0380162697085,\n"
        + "                  \"lng\" : 135.7278815197085\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJLxi4xCCoAWAR0nKK_sUaOtM\",\n"
        + "         \"types\" : [ \"premise\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"\",\n"
        + "               \"short_name\" : \"\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_4\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kinkakujich\",\n"
        + "               \"short_name\" : \"Kinkakujich\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kita-ku\",\n"
        + "               \"short_name\" : \"Kita-ku\",\n"
        + "               \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyto-shi\",\n"
        + "               \"short_name\" : \"Kyto-shi\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyto-fu\",\n"
        + "               \"short_name\" : \"Kyto-fu\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"603-8361\",\n"
        + "               \"short_name\" : \"603-8361\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Japan, 603-8361 Kyto-fu, Kyto-shi, Kita-ku, Kinkakujich, \",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0393553,\n"
        + "               \"lng\" : 135.7293265\n"
        + "            },\n"
        + "            \"location_type\" : \"GEOMETRIC_CENTER\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.04070428029149,\n"
        + "                  \"lng\" : 135.7306754802915\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0380063197085,\n"
        + "                  \"lng\" : 135.7279775197085\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJnT1kwyCoAWAR-d2HQrYxlTs\",\n"
        + "         \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_4\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Kinkakujicho\",\n"
        + "               \"short_name\" : \"Kinkakujicho\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kita Ward\",\n"
        + "               \"short_name\" : \"Kita Ward\",\n"
        + "               \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto\",\n"
        + "               \"short_name\" : \"Kyoto\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto Prefecture\",\n"
        + "               \"short_name\" : \"Kyoto Prefecture\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"603-8361\",\n"
        + "               \"short_name\" : \"603-8361\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Kinkakujicho, Kita Ward, Kyoto, Kyoto Prefecture 603-8361, Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0409162,\n"
        + "                  \"lng\" : 135.7318809\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0381293,\n"
        + "                  \"lng\" : 135.7271086\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0393553,\n"
        + "               \"lng\" : 135.7293265\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0409162,\n"
        + "                  \"lng\" : 135.7318809\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0381293,\n"
        + "                  \"lng\" : 135.7271086\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJe9XMwiCoAWARVrQpOsYqdBE\",\n"
        + "         \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Kita Ward\",\n"
        + "               \"short_name\" : \"Kita Ward\",\n"
        + "               \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto\",\n"
        + "               \"short_name\" : \"Kyoto\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto Prefecture\",\n"
        + "               \"short_name\" : \"Kyoto Prefecture\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Kita Ward, Kyoto, Kyoto Prefecture, Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.1714945,\n"
        + "                  \"lng\" : 135.7728535\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0222614,\n"
        + "                  \"lng\" : 135.6471605\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.041053,\n"
        + "               \"lng\" : 135.7539826\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.1714945,\n"
        + "                  \"lng\" : 135.7728535\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0222614,\n"
        + "                  \"lng\" : 135.6471605\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJHSR_jiupAWARcQjngz-_Cxk\",\n"
        + "         \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto\",\n"
        + "               \"short_name\" : \"Kyoto\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto Prefecture\",\n"
        + "               \"short_name\" : \"Kyoto Prefecture\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Kyoto, Kyoto Prefecture, Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.32119230000001,\n"
        + "                  \"lng\" : 135.878779\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.8748598,\n"
        + "                  \"lng\" : 135.5589845\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0116363,\n"
        + "               \"lng\" : 135.7680294\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0542,\n"
        + "                  \"lng\" : 135.8236\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.958,\n"
        + "                  \"lng\" : 135.6983\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ8cM8zdaoAWARPR27azYdlsA\",\n"
        + "         \"types\" : [ \"locality\", \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"603-8361\",\n"
        + "               \"short_name\" : \"603-8361\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kinkakujicho\",\n"
        + "               \"short_name\" : \"Kinkakujicho\",\n"
        + "               \"types\" : [ \"political\", \"sublocality\", \"sublocality_level_1\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kita Ward\",\n"
        + "               \"short_name\" : \"Kita Ward\",\n"
        + "               \"types\" : [ \"locality\", \"political\", \"ward\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto\",\n"
        + "               \"short_name\" : \"Kyoto\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto Prefecture\",\n"
        + "               \"short_name\" : \"Kyoto Prefecture\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"603-8361, Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0409162,\n"
        + "                  \"lng\" : 135.7318809\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0381293,\n"
        + "                  \"lng\" : 135.7271086\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0392985,\n"
        + "               \"lng\" : 135.7290044\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.0409162,\n"
        + "                  \"lng\" : 135.7318809\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 35.0381293,\n"
        + "                  \"lng\" : 135.7271086\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJnT1kwyCoAWARkK61Za4dRY4\",\n"
        + "         \"types\" : [ \"postal_code\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Osaka Metropolitan Area\",\n"
        + "               \"short_name\" : \"Osaka Metropolitan Area\",\n"
        + "               \"types\" : [ \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Japan, Osaka Metropolitan Area\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.1393087,\n"
        + "                  \"lng\" : 136.0102211\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.3113767,\n"
        + "                  \"lng\" : 134.4371108\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 34.7307812,\n"
        + "               \"lng\" : 135.5251982\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.1393087,\n"
        + "                  \"lng\" : 136.0102211\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.3113767,\n"
        + "                  \"lng\" : 134.4371108\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJN7QiqzCwAGAR3arYsOjiWEY\",\n"
        + "         \"types\" : [ \"political\" ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Kyoto Prefecture\",\n"
        + "               \"short_name\" : \"Kyoto Prefecture\",\n"
        + "               \"types\" : [\n"
        + "                  \"administrative_area_level_1\",\n"
        + "                  \"establishment\",\n"
        + "                  \"point_of_interest\",\n"
        + "                  \"political\"\n"
        + "               ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Kyoto Prefecture, Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.7793193,\n"
        + "                  \"lng\" : 136.0540829\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.7059884,\n"
        + "                  \"lng\" : 134.8536955\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 35.0212466,\n"
        + "               \"lng\" : 135.7555968\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 35.7793193,\n"
        + "                  \"lng\" : 136.0540829\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 34.7059885,\n"
        + "                  \"lng\" : 134.8536957\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJYRsf-SB0_18ROJWxOMJ7Clk\",\n"
        + "         \"types\" : [\n"
        + "            \"administrative_area_level_1\",\n"
        + "            \"establishment\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"political\"\n"
        + "         ]\n"
        + "      },\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"Japan\",\n"
        + "               \"short_name\" : \"JP\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"Japan\",\n"
        + "         \"geometry\" : {\n"
        + "            \"bounds\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 45.6412626,\n"
        + "                  \"lng\" : 154.0031455\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 20.3585295,\n"
        + "                  \"lng\" : 122.8554688\n"
        + "               }\n"
        + "            },\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 36.204824,\n"
        + "               \"lng\" : 138.252924\n"
        + "            },\n"
        + "            \"location_type\" : \"APPROXIMATE\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 45.52177229999999,\n"
        + "                  \"lng\" : 145.8162778\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 24.0459244,\n"
        + "                  \"lng\" : 122.9338302\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJLxl_1w9OZzQRRFJmfNR1QvU\",\n"
        + "         \"types\" : [ \"country\", \"political\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    LatLng location = new LatLng(35.03937, 135.729243);
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .latlng(location).await();

    assertNotNull(results);
    assertEquals("Japan, 603-8361 Kyto-fu, Kyto-shi, Kita-ku, Kinkakujich,  ",
        results[0].formattedAddress);
    assertEquals("Kita Ward", results[3].addressComponents[0].shortName);
    assertEquals("Kita Ward", results[3].addressComponents[0].longName);
    assertEquals(AddressComponentType.LOCALITY,
        results[3].addressComponents[0].types[0]);
    assertEquals(AddressComponentType.POLITICAL,
        results[3].addressComponents[0].types[1]);
    assertEquals(AddressComponentType.WARD,
        results[3].addressComponents[0].types[2]);

    sc.assertParamValue(location.toUrlValue(), "latlng");
  }

  /**
   * Testing supported Address Types for Geocoding.
   */
  @Test
  public void testSupportedAddressTypesFood() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"21800\",\n"
        + "               \"short_name\" : \"21800\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"West Eleven Mile Road\",\n"
        + "               \"short_name\" : \"W Eleven Mile Rd\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Southfield\",\n"
        + "               \"short_name\" : \"Southfield\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Oakland County\",\n"
        + "               \"short_name\" : \"Oakland County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Michigan\",\n"
        + "               \"short_name\" : \"MI\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"48076\",\n"
        + "               \"short_name\" : \"48076\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"21800 W Eleven Mile Rd, Southfield, MI 48076, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 42.4879618,\n"
        + "               \"lng\" : -83.2595228\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 42.4893107802915,\n"
        + "                  \"lng\" : -83.25817381970849\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 42.4866128197085,\n"
        + "                  \"lng\" : -83.26087178029151\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJ6zOD5dy3JIgRgsMEeGna5dI\",\n"
        + "         \"types\" : [\n"
        + "            \"establishment\",\n"
        + "            \"food\",\n"
        + "            \"grocery_or_supermarket\",\n"
        + "            \"point_of_interest\",\n"
        + "            \"store\"\n"
        + "         ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    String address = "Noah's Marketplace, 21800 W Eleven Mile Rd";
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .address(address).await();

    assertNotNull(results);
    assertEquals(AddressType.ESTABLISHMENT, results[0].types[0]);
    assertEquals(AddressType.FOOD, results[0].types[1]);
    assertEquals(AddressType.GROCERY_OR_SUPERMARKET, results[0].types[2]);
    assertEquals(AddressType.POINT_OF_INTEREST, results[0].types[3]);
    assertEquals(AddressType.STORE, results[0].types[4]);

    sc.assertParamValue(address, "address");
  }

  /**
   * Testing supported Address Types for Geocoding - Synagogue.
   */
  @Test
  public void testSupportedAddressTypesSynagogue() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"address_components\" : [\n"
        + "            {\n"
        + "               \"long_name\" : \"15620\",\n"
        + "               \"short_name\" : \"15620\",\n"
        + "               \"types\" : [ \"street_number\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"West 10 Mile Road\",\n"
        + "               \"short_name\" : \"W 10 Mile Rd\",\n"
        + "               \"types\" : [ \"route\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Southfield\",\n"
        + "               \"short_name\" : \"Southfield\",\n"
        + "               \"types\" : [ \"locality\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Oakland County\",\n"
        + "               \"short_name\" : \"Oakland County\",\n"
        + "               \"types\" : [ \"administrative_area_level_2\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"Michigan\",\n"
        + "               \"short_name\" : \"MI\",\n"
        + "               \"types\" : [ \"administrative_area_level_1\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"United States\",\n"
        + "               \"short_name\" : \"US\",\n"
        + "               \"types\" : [ \"country\", \"political\" ]\n"
        + "            },\n"
        + "            {\n"
        + "               \"long_name\" : \"48075\",\n"
        + "               \"short_name\" : \"48075\",\n"
        + "               \"types\" : [ \"postal_code\" ]\n"
        + "            }\n"
        + "         ],\n"
        + "         \"formatted_address\" : \"15620 W 10 Mile Rd, Southfield, MI 48075, USA\",\n"
        + "         \"geometry\" : {\n"
        + "            \"location\" : {\n"
        + "               \"lat\" : 42.4742111,\n"
        + "               \"lng\" : -83.2046522\n"
        + "            },\n"
        + "            \"location_type\" : \"ROOFTOP\",\n"
        + "            \"viewport\" : {\n"
        + "               \"northeast\" : {\n"
        + "                  \"lat\" : 42.4755600802915,\n"
        + "                  \"lng\" : -83.20330321970849\n"
        + "               },\n"
        + "               \"southwest\" : {\n"
        + "                  \"lat\" : 42.4728621197085,\n"
        + "                  \"lng\" : -83.20600118029151\n"
        + "               }\n"
        + "            }\n"
        + "         },\n"
        + "         \"place_id\" : \"ChIJn5hABPnIJIgRr_d3wqujFS0\",\n"
        + "         \"types\" : [ \"establishment\", \"place_of_worship\", \"point_of_interest\", \"synagogue\" ]\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    String address = "Ahavas Olam, 15620 W. Ten Mile Road";
    GeocodingResult[] results = GeocodingApi.newRequest(sc.context)
        .address(address).await();

    assertNotNull(results);
    assertEquals(AddressType.ESTABLISHMENT, results[0].types[0]);
    assertEquals(AddressType.PLACE_OF_WORSHIP, results[0].types[1]);
    assertEquals(AddressType.POINT_OF_INTEREST, results[0].types[2]);
    assertEquals(AddressType.SYNAGOGUE, results[0].types[3]);

    sc.assertParamValue(address, "address");
  }

}
